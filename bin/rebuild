#!/bin/bash

# Rebuilds Zenoss (cleaning out any artifacts of previous build).

zenoss-clean
pushd $ZENSRC > /dev/null
if [ -d .svn ]; then
    svn-ignored | xargs rm -rf
    svn up
elif [ -d .git ]; then
    git svn rebase
    git clean -f -d -x
fi
pushd inst > /dev/null
link-products || exit 1
time ./install.sh "$@" || exit 1
make clean
zenoss stop
perl -pi -e 's/#    debug-mode on/debug-mode on/' $ZENHOME/etc/zope.conf
build-protocols
popd > /dev/null
popd > /dev/null
